
 #                  #
 # FFMPEG Converter #
 #      README      #   

 USAGE: 
 # windows (powershell, cmd) 
 ffmpeg [Global_OPTIONS] [SOURCE OPTIONS] -i SOURCEFILE [TARGETFILE OPTIONS] TARGETFILE 

 # linux konsole
 ffmpeg [Global_OPTIONS] [SOURCE OPTIONS] -i SOURCEFILE [TARGETFILE OPTIONS] TARGETFILE    

 # Run ffmpeg with higher priority (more cpu time) 
 # (realtime priority is not recommended because system instability)
 # start /HIGH ffmpeg -i         
 # start /abovenormal ffmpeg -i
 # linux: nice -n -10 ffmpeg -i 

 !! Issues with Space in Filenames in FFmpeg !!
 # Use Quotation Marks ("")
 # ffmpeg -i "My Audio File.mp3" -c:a libopus output.opus


### Example to use ffmpeg in a script (cmd)
@echo off
echo Welcome to the FFmpeg conversion script!

:: Ask user for input file
set /p inputFile="Please enter the full path of the input file (e.g., C:\path\to\input.mp4): "

:: Ask user for output file
set /p outputFile="Please enter the full path of the output file (e.g., C:\path\to\output.mkv): "

:: Execute the FFmpeg command
ffmpeg -i "%inputFile%" -c:v copy -c:a copy "%outputFile%"

echo Conversion completed!
pause
###


# Best crf and Average bitrate:
# -crf 18 - 24 (x265: -crf 20 - 26)
# -vb 1700k - 2300k  # Good quality
# -vb 2400k - 3600k  # High quality
# -vb 3700k - 4600k  # Very high quality (high file size)

# Best settings for average bitrate. 
# ( -maxrate Sets the maxium allowed bitrate. Helps to avoid bitrate spikes)
# ( -bufsize Defines the buffer size for video encoding, used with -maxrate. Set -bufsize to 2x -b:v)
ffmpeg -i input.mp4 -b:v 1500k -maxrate 2000k -bufsize 3000k -b:a 192k -preset slow output.mp4

## Example for calculating a fix video filesize:
If you want a 10 MB file for a video that is 50 seconds long:

     Calculate the bitrate:
  1. File Size = 10 MB = 10,000 KB      2. File Size = 2400 = 2400 x 1024 = 2457.600 KB
     Duration = 50 seconds                 Duration = 1h (3600 seconds), 30min = (1800 seconds) = 5400 seconds

    Bitrate=10000×8/50​= 1600 kbps         Bitrate=2.457.600×8/5400​≈ 3642,67 kbps



### FFMPEG Options and tweaks

# Metadata from source file to targetfile
ffmpeg -i <sourcefile> -map_metadata 0 -movflags use_metadata_tags

# Video scale (from 4k to fhd etc)
ffmpeg -i input.mp4 -vf "scale=1920x1080" output.mp4

# Video scaling with high quality (langczos filter)
ffmpeg -i input.mp4 -vf "scale=1920:1080:flags=lanczos"

# Preset superfast is like realtime. You should use that instead of -preset ultrafast. 
# Ultrafast is far less efficient compression than superfast.
-preset superfast

# Preset medium and slow (better compression efficiency and improved quality at the expense of encoding time)
-preset medium , -preset slow 

# Using video denoise
-vf "hqdn3d"

# Optimizes settings for animated content to maintain color fidelity and detail.
-tune animation

# Using AV1 Video codec insteed of x264 or 265
ffmpeg -i 20230722_135205.mp4 -c:v libsvtav1 -b:v 2000k -c:a aac -b:a 224k -strict experimental output.mkv

# Convert MP4 into MKV without re-encoding, making the conversion faster and preventing quality.
ffmpeg -i input.mp4 -c copy output.mkv

# Using subtitles
-c:s copy                    # using the subtitles without a change from the source (best choise)
-c:s mov_text                # Subtitles are embedded in the video.
-scodec srt                  # save as separate file
-vf "subtitles=input.srt"    # Hardcoding (burns the subtitle into the videofile)


# Convert all .mp4 to mkv and shutdown the pc (navigate with cd to the location with the video file before)
for %f in (*.mp4) do ffmpeg -i "%f" -c:v libx265 -crf 23 -c:a copy "%~nf.mkv" && shutdown /s /t 0


::264
# Better quality with x264 (but a little bit slower encoding speed)
-x264opts fast_pskip=0 , -profile:v high , -level 4.1 or -level 4.2

# Enables adaptive quantization for better-quality detail retention.
# Sets the maximum number of B-frames between I/P-frames to improve compression efficiency.
-x264-params "aq-mode=1:bframes=16"


::265
# Better quality for x265 (Increase rate-distortion optimization for better quality at the same bitrate.)
--rd 4

# Sets the maximum interval between I-frames to improve compression.
--keyint 240

# (x265 only) Optimizes encoding for sources with grain for better quality retention.
-tune grain



# AAC Variable Bitrate (VBR) (4 and 5 for best quality)
-acodec aac -vbr 5

# No Chapters
-map_chapters -1

# A/V Synchro (Automatic)
-sync -1


# Prevents ffmpeg from outputting its copyright notice, build options and library versions
-hide_banner

# Modulates verbosity (fine-tuning options are available), e.g. -loglevel warning
-loglevel 

# Disables printing of encoding progress/statistics
-nostats

# Only pv output (No warnings etc)
-v quiet

 #######


- Convert Video

:: x264

# Convert to x264 vb and aac 224k 2.0 medium preset
ffmpeg -i D:\Sourcefile -vcodec libx264 -vb 2400k -tune film -tune fastdecode -preset medium -acodec aac -ab 224k -ac 2 D:\Output.mp4

# Convert to x264 crf and aac 224k 2.0 medium preset
ffmpeg -i D:\Sourcefile -vcodec libx264 -crf 20 -tune film -tune fastdecode -preset medium -acodec aac -ab 224k -ac 2 D:\Output.mp4

# Convert to x264 vb and 224k 2.0 medium preset and high profile lvl 4
ffmpeg -i D:\Sourcefile -vcodec libx264 -vb 2400k -vprofile high -level 40 -s 1920x1080 -tune film -tune fastdecode -preset medium -acodec aac -ab 224k -ac 2 -y D:\Output.mp4 

# Convert to x264 crf 23 preset medium with decomb fast
ffmpeg -i input.mp4 -vf "decomb=mode=fast" -c:v libx264 -crf 23 -preset medium -c:a copy output.mp4


:: x265

# Convert to x265 aac 224k
ffmpeg -i D:\input -c:v libx265 -crf 22 -tune film -tune fastdecode -preset medium -c:a aac -b:a 224k -ac 2 D:\output.mp4

# Convert to x265 vb and aac 224k 2.0 medium preset
ffmpeg -i D:\input -c:v libx265 -vb 2400k -tune film -tune fastdecode -preset medium -c:a aac -b:a 224k -ac 2 D:\output.mp4

# Convert webm to x265
ffmpeg -i input.webm -c:v libx265 -b:v 2200k -preset medium -c:a aac -b:a 224k output.mp4


:: AVI

# Convert MP4 into an AVI File (Same quality)
ffmpeg -i filename.mp4 -vcodec copy -acodec copy filename.avi

# Convert MKV into AVI High Quality
ffmpeg -i input.mkv -codec:v libx264 -preset slow -crf 18 -codec:a copy output.avi




- Convert into Audio

# into aac 256k
ffmpeg -i input.wav -c:a aac -b:a 256k output.aac

# recoding
ffmpeg -i input-video.mp4 -acodec copy output.mp3

# Convert into mp3 with using presets (high and extreme for best quality)
ffmpeg -i input.wav lame --preset extreme  output.mp3

# simple command to extract audio from a video file
ffmpeg -i input-video.mp4 output-audio.mp3


# Convert into Flac (level 5 is recommended value)
ffmpeg -i input.wav -compression_level 5 output.flac

# Convert into Opus
ffmpeg -i input.wav opusenc --bitrate 256k output.opus
ffmpeg -i input.mp3 -c:a libopus -b:a 256k output.opus

# Convert into OGG Vorbis (with quality settings)
ffmpeg -i input.wav oggenc -q5 output.ogg



