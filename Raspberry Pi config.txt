# Raspberry Pi 5

# Config

# OS; Raspberry OS Lite 64bit

# On bootet Rasperry Pi (Linux)
# ssh: lxdmin@192.168.0.3   (change the last number to right one)
# On Error; WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @
# ssh-keygen -R 192.168.0.3

# Rasperry Shutdown (Version 5 and newer): 1. Power Button  2. or over ssh: sudo poweroff


sudo apt update
sudo apt dist-upgrade

sudo apt install -y fakeroot flashrom smartmontools quota bridge-utils xfsdump mtools f2fs-tools curl openssl samba nfs-kernel-server
sudo apt install cpufrequtils htop
sudo cpufreq-set -g performance


# Install and a firewall:
sudo apt install ufw

# UFW port settings
sudo ufw allow ssh
sudo ufw allow 53/tcp
sudo ufw allow 53/udp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp                               # Optional, if using HTTPS
sudo ufw allow from 192.168.1.0/24 to any port 80
sudo ufw allow from 192.168.1.0/24 to any port 443   # Optional


sudo ufw enable


# Recommended /boot/config.txt Settings for Raspberry Pi 5

# Enable the onboard audio (loads snd_bcm2835)
dtparam=audio=on

# Overclocking settings (optional)
# Uncomment and adjust these settings if you want to overclock
# over_voltage=6
# arm_freq=2200

# Set the GPU memory split (gpu_men=16 for terminal based use only)
gpu_mem=128

# Enable the 64-bit kernel (if not already enabled)
arm_64bit=1

# Set the HDMI output to a specific mode (optional)
hdmi_group=1
hdmi_mode=16  # 1080p @ 60Hz

# Enable USB boot (if needed)
program_usb_boot_mode=1

# Enable the camera interface (if using a camera)
start_x=1

# Enable the I2C interface (if using I2C devices)
dtparam=i2c_arm=on

# Enable SPI interface (if using SPI devices)
dtparam=spi=on

# Enable the 1-wire interface (if using 1-wire devices)
dtoverlay=w1-gpio

# Enable the GPIO pins (if needed)
# dtoverlay=gpio-keys

# Set the maximum CPU temperature (optional)
# temp_limit=85

# Disable the rainbow splash screen (optional)
disable_splash=1

# Set the boot delay (optional)
boot_delay=0

# Enable the serial console (if needed)
enable_uart=1

# Set the HDMI safe mode (optional)
hdmi_safe=1

# Uncomment to enable the Pi-hole DNS server (if using Pi-hole)
# dtoverlay=pi3-disable-bt

# Uncomment to enable the Pi-hole DHCP server (if using Pi-hole)
# dhcp-range=192.168.1.100,192.168.1.200,24h






# Webmin
curl -o webmin-setup-repos.sh https://raw.githubusercontent.com/webmin/webmin/master/webmin-setup-repos.sh
sudo sh webmin-setup-repos.sh

sudo apt-get install webmin --install-recommends

# After install and config.
https://192.68.0.3:10000




# Pi-Hole:

curl -sSL https://install.pi-hole.net | bash

# After install and config. 
http://192.168.0.3/admin





# Proxmox VE:

curl -L https://mirrors.apqa.cn/proxmox/debian/pveport.gpg | sudo tee /usr/share/keyrings/pveport.gpg > /dev/null

echo "deb [arch=arm64 signed-by=/usr/share/keyrings/pveport.gpg] https://mirrors.apqa.cn/proxmox/debian/pve bookworm port" | sudo tee /etc/apt/sources.list.d/pveport.list

sudo apt install ifupdown2

If you encounter an error, remove the temporary file and try again:
sudo rm /tmp/.ifupdown2-first-install
sudo apt install ifupdown2

sudo nano /etc/network/interfaces

# Add the following configuration, replacing <IPADDRESS> and <GATEWAY> with your actual values:

auto lo
iface lo inet loopback
auto eth0
iface eth0 inet manual
auto vmbr0

iface vmbr0 inet manual
   address <IPADDRESS>
   gateway <GATEWAY>
   netmask 255.255.255.0
   bridge-ports eth0
   bridge-stp off
   bridge-fd 0


# Set the Root Password (if not allready set)
sudo passwd root


# hosts settings
127.0.0.1       raspberrypi   (change the 127.0.0.1 to 192.168.0.3)

check the settings with "hostname --ip-address"


sudo reboot


# Install Proxmox VE:
sudo apt update && sudo apt install proxmox-ve postfix open-iscsi pve-edk2-firmware-aarch64

# UFW settings
sudo ufw allow 8006/tcp   # Proxmox web interface
sudo ufw allow 5404/udp   # Cluster communication
sudo ufw allow 5405/udp   # Cluster communication
sudo ufw allow 5900:5999/tcp  # VNC console ports (adjust range as needed)
sudo ufw allow 3128/tcp    # Spice console


# After install and config.
https://<IPADDRESS>:8006

